{% extends "base.html" %}
{% block content %}
<a class="btn btn-link" href="{{ url_for('jobs_list') }}">&larr; Back</a>
<h3 class="mb-1">{{ job.role }} <small class="text-muted">at {{ job.company }}</small></h3>
<p class="text-muted">{{ job.location or "" }} • Saved {{ job.created_at.strftime("%Y-%m-%d %H:%M") }}</p>

<div class="row g-3">
  <div class="col-lg-4">
    <div class="card shadow-sm h-100">
      <div class="card-body">
        <h5>Match Score</h5>
        <div class="display-5">{{ job.match_score }}%</div>
        <hr/>
        <form method="POST" action="{{ url_for('update_job', job_id=job.id) }}">
          <div class="mb-2">
            <label class="form-label">Status</label>
            <select class="form-select" name="status">
              {% for opt in ["Interested","Applied","Interview","Offer","Rejected"] %}
                <option value="{{ opt }}" {% if job.status==opt %}selected{% endif %}>{{ opt }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="mb-2">
            <label class="form-label">Notes</label>
            <textarea class="form-control" name="notes" rows="3" placeholder="Add notes...">{{ job.notes or "" }}</textarea>
          </div>
          <button class="btn btn-sm btn-primary" type="submit">Save</button>
        </form>
        <hr/>
        <h6>Matched Skills</h6>
        <div>
          {% for s in (job.matched_skills.split(",") if job.matched_skills else []) %}
            <span class="badge bg-success-subtle border text-success me-1">{{ s }}</span>
          {% endfor %}
        </div>
        <h6 class="mt-3">Missing Skills</h6>
        <div>
          {% for s in (job.missing_skills.split(",") if job.missing_skills else []) %}
            <span class="badge bg-danger-subtle border text-danger me-1">{{ s }}</span>
          {% endfor %}
          {% if not job.missing_skills %}
            <span class="text-muted">None detected</span>
          {% endif %}
        </div>
        <hr/>
        <h6>Suggested Resume Bullets (for Missing Skills)</h6>
        {% if bullets %}
          <ul class="mb-0">
            {% for b in bullets %}
              <li>{{ b }}</li>
            {% endfor %}
          </ul>
          <p class="text-muted mt-2 mb-0">Tip: Copy these into your resume and tweak to your real experience.</p>
        {% else %}
          <div class="text-muted">No suggestions — no missing skills detected.</div>
        {% endif %}

      </div>
    </div>
  </div>

  <div class="col-lg-8">
    <div class="card shadow-sm h-100">
      <div class="card-body">
        <h5>Job Description</h5>
        <pre class="jd">{{ job.description }}</pre>
      </div>
    </div>
  </div>
</div>
{% endblock %}
